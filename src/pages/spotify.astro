---
import Layout from '../layouts/ShopLayout.astro';
import { getTopTracks } from '../utils/spotify/api';

const clientId = 'f6af48791a99465e8a5eb950464a9c15';
const redirectUri = 'https://ctrujillo.netlify.app/callback'; // your callback URL
const scopes = encodeURIComponent('user-read-private user-read-email user-top-read');
const authUrl = `https://accounts.spotify.com/authorize?client_id=${clientId}&response_type=code&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${scopes}`;

const token = Astro.cookies.get('spotify_token')?.value;
let topTracks = [];

if (token) {
  try {
    topTracks = await getTopTracks(token);
  } catch (e) {
    console.error('Spotify API failed:', e);
  }
}
---

<Layout title="My Spotify">
  <main>
    <h1 class="graduate-pink-center">My Top Spotify Tracks ðŸŽ¶</h1>

    {topTracks.length > 0 ? (
      <ul class="pink-text">
        {topTracks.map(track => (
          <li>
            <strong>{track.name}</strong> by {track.artists.map(a => a.name).join(', ')}
          </li>
        ))}
      </ul>
    ) : (
      <>
        
        <a href={authUrl} class="login-button">Log in with Spotify</a>
      </>
    )}
  </main>

  <style>
    .graduate-pink-center {
      color: #ff66cc; /* pink color */
      text-align: center;
      font-family: 'Graduate', cursive;
    }

    .pink-text {
      color: #ff66cc;
      font-size: 1.2rem;
      text-align: center;
      margin-bottom: 1rem;
    }

    .login-button {
      display: inline-block;
      background-color: #1db954;
      color: white;
      font-weight: bold;
      padding: 0.75rem 1.5rem;
      border-radius: 50px;
      text-decoration: none;
      font-size: 1.1rem;
      transition: background-color 0.3s ease;
      text-align: center;
      margin: 0 auto;
    }

    .login-button:hover {
      background-color: #1ed760;
    }
  </style>
</Layout>
